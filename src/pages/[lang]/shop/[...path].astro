---
import { initShopwareSite } from '@components/shopware/helpers/server';
import { getLayoutData } from '@helpers/layout';
import {
    setClangId,
    setProperty,
} from '@helpers/properties-management/server-properties';
import SwLayout from '@layouts/SwLayout.astro';
let { path, lang } = Astro.params;
path ??= '/';

if (path === 'sitemap.xml' || path === 'robots.txt') {
    return Astro.redirect(`${import.meta.env.REDAXO_ROOT}/${path}`, 301);
}

const {
    contentType,
    article,
    clangs,
    footerArticle,
    currentClang,
    navigation,
    siteStartArticle,
} = await getLayoutData(path, 2);
setClangId(Astro, currentClang.id);
setProperty(Astro, 'clangCode', currentClang.code);

const {
    component: Component,
    data,
    redirect,
} = await initShopwareSite(Astro, path ?? '/', lang ?? '');

if (redirect) {
    return Astro.redirect(redirect, 301);
}
---

<SwLayout
    article={article}
    currentClang={currentClang}
    metadata={contentType.metadata}
    clangs={clangs}
    footerArticle={footerArticle}
    navigation={navigation}
    siteStartArticle={siteStartArticle}
    path={path}
>
    {Component ? <Component /> : null}
</SwLayout>
