---
import { GenericRedaxoAdapter } from '../adapters/generic-redaxo-adapter';
import Layout from '@layouts/Layout.astro';
import {
    getAllProperties,
    setArticleId,
    setClangId,
} from '@helpers/properties-management/server-properties';
import WildcardCache from '@helpers/wildcards';
import { RedaxoAdapter } from '@adapters/redaxo';

const { path } = Astro.params;

if (path === 'sitemap.xml' || path === 'robots.txt') {
    return Astro.redirect(`${redaxoRoot}/${path}`, 301);
}

const article = await RedaxoAdapter.getArticleByPath(path ?? '/', '1', {
    breadcrumbs: true,
    seo: true,
    slices: true,
    clang: true,
});

const clangId = article.clang.id;
await WildcardCache.prepareCache(clangId);
setClangId(Astro, clangId);
setArticleId(Astro, article.id);

const allStates = getAllProperties(Astro);
---

<Layout article={article} />
<script define:vars={{ allStates }}>
    //@ts-ignore
    window._states = allStates;
    //@ts-ignore
    window.getState = (key) => {
        //@ts-ignore
        return window._states[key];
    };
</script>
