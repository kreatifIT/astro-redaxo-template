---
import { getCategoryProducts } from '@shopware-pwa/shopware-6-client';
import ProductList from '../utils/ProductList';
import Container from '@utils/grid/Container.astro';

const { itemId, contextInstance, sessionContext } = Astro.props;
const productStep = 15;

let activeCatId = itemId || null;
if (activeCatId == null) {
    activeCatId = sessionContext.salesChannel.navigationCategoryId;
}

let page = Astro.url.searchParams.get('page')! || 1;
page = parseInt(page);

const productListing = await getCategoryProducts(
    activeCatId,
    {
        p: page,
        limit: productStep,
        associations: { seoUrls: ['id', 'pathInfo'], categories: ['id'] },
    },
    contextInstance,
);
---

<Container>
    <ProductList
        currentPage={page}
        client:only="preact"
        productStep={productStep}
        productListing={productListing}
    />
</Container>
