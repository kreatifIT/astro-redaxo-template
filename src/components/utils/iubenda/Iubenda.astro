---
import { getBanner } from '@helpers/iubenda';
import { getClangId } from '@helpers/properties-management/server-properties';
import { RedaxoAdapter } from '@adapters/redaxo';
import type { Article } from '@adapters/generic-redaxo-adapter/@types';
import { getSettings } from '@helpers/wildcards';
import './Iubenda.scss';

interface Props {
    article: Article;
}

const { article } = Astro.props;

const clangId = getClangId(Astro);
const clangs = await RedaxoAdapter.getClangs(article.id, clangId);
const bannerHTML = getBanner(Astro, clangs);
const settings = getSettings(Astro);
---

<Fragment
    set:html={settings.iubendaCookieBanner?.bannerData.replace(
        '{{BANNER_HTML}}',
        bannerHTML,
    )}
/>
<script type="text/javascript" is:inline>
    window.iubendaLanguageSwitch = () => {
        const menuToggler = document.querySelector(
            '.cookieBannerLanguageSwitch .cookieBannerLanguageToggler',
        );
        const menu = document.querySelector('.cookieBannerLanguageSwitch');
        menuToggler.onclick = () => {
            menu.classList.toggle('menu-open');
        };
    };
</script>
