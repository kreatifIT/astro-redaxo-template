---
interface Props {
    contextInstance: any;
    sessionContext: any;
    customer: any;
}
const { contextInstance, customer, sessionContext } = Astro.props;
---

<script define:vars={{ contextInstance, customer, sessionContext }} lang="">
    import {
        ShopwareApiInstanceStore,
        cartStore,
        contextStore,
        customerStore,
        customerWhishlistStore,
    } from '@components/shopware/utils/shopware-store';
    import {
        ShopwareApiInstance,
        getCart,
        getCustomer,
        getSessionContext,
        getWishlistProducts,
    } from '@shopware-pwa/shopware-6-client';

    const contextInstance = ShopwareApiInstanceStore.get();

    const context = await getSessionContext(contextInstance);
    contextStore.set(context); //addresses
    let customer = null;
    let customerWhishlist = null;
    if (context.customer) {
        customer = await getCustomer(
            {
                associations: {
                    defaultBillingAddress: {
                        associations: {
                            country: {},
                        },
                    },
                    defaultShippingAddress: {
                        associations: {
                            country: {},
                        },
                    },
                    addresses: {
                        associations: {
                            country: {},
                        },
                    },
                    defaultPaymentMethod: {},
                },
            },
            contextInstance as ShopwareApiInstance,
        );

        customerWhishlist = await getWishlistProducts(
            {},
            contextInstance as ShopwareApiInstance,
        );
    }

    customerStore.set(customer);
    customerWhishlistStore.set(customerWhishlist);

    const cart = await getCart(contextInstance);
    cartStore.set(cart);
</script>
